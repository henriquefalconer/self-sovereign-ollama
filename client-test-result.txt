================================================
  remote-ollama ai-client Test Suite
  Running 40 tests
================================================

=== Environment Configuration Tests ===
[0;34m[INFO][0m Checking if env file exists at /Users/vm/.ai-client/env...
[0;32mâœ“ PASS[0m Environment file exists (~/.ai-client/env)
[0;34m[INFO][0m Checking required environment variables...
[0;32mâœ“ PASS[0m OLLAMA_API_BASE is set: http://remote-ollama:11434
[0;32mâœ“ PASS[0m OPENAI_API_BASE is set: http://remote-ollama:11434/v1
[0;32mâœ“ PASS[0m OPENAI_API_KEY is set correctly: ollama
[1;33mâŠ˜ SKIP[0m AIDER_MODEL is not set (optional)
  [0;34mTo enable:[0m Uncomment and set AIDER_MODEL in ~/.ai-client/env
[0;34m[INFO][0m Checking if shell profile sources env file...
[0;32mâœ“ PASS[0m Shell profile sources env file (/Users/vm/.zshrc)
[0;34m[INFO][0m Checking if environment variables are exported...
[0;32mâœ“ PASS[0m Environment variables are exported in env file

=== Dependency Tests ===
[0;34m[INFO][0m Checking for Tailscale...
[0;32mâœ“ PASS[0m Tailscale is installed
[0;34m[INFO][0m Checking Tailscale status...
[0;32mâœ“ PASS[0m Tailscale is connected (IP: 100.91.192.8)
[0;34m[INFO][0m Checking for Homebrew...
[0;32mâœ“ PASS[0m Homebrew is installed
[0;34m[INFO][0m Checking for Python 3.10+...
[0;32mâœ“ PASS[0m Python 3.14 found (>= 3.10)
[0;34m[INFO][0m Checking for pipx...
[0;32mâœ“ PASS[0m pipx is installed
[0;34m[INFO][0m Checking for Aider...
[0;32mâœ“ PASS[0m Aider is installed: aider 0.86.1

=== Connectivity Tests ===
[0;34m[INFO][0m Using server URL: http://remote-ollama:11434
[0;34m[INFO][0m Testing connectivity to server...
[0;32mâœ“ PASS[0m Server is reachable (remote-ollama)
[0;34m[INFO][0m Testing GET /v1/models...
[0;34m[INFO][0m Request: GET http://remote-ollama:11434/v1/models
[0;34m[INFO][0m HTTP Status: 200
[0;34m[INFO][0m Response Body:   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Host remote-ollama:11434 was resolved.
{ [108 bytes data]
100   108  100   108    0     0   5062      0 --:--:-- --:--:-- --:--:--  5142
{"object":"list","data":[{"id":"qwen2.5:0.5b","object":"model","created":1770768171,"owned_by":"library"}]}
[0;34m[INFO][0m Elapsed time: 46220000000ms
[0;31mâœ— FAIL[0m GET /v1/models failed or returned invalid JSON
[1;33mâŠ˜ SKIP[0m GET /v1/models/{model} - no models available
  [0;34mTo enable:[0m Pull a model on the server first (e.g., ollama pull llama3.2)
[1;33mâŠ˜ SKIP[0m POST /v1/chat/completions (non-streaming) - no models available
  [0;34mTo enable:[0m Pull a model on the server first (e.g., ollama pull llama3.2)
[1;33mâŠ˜ SKIP[0m POST /v1/chat/completions (streaming) - no models available
  [0;34mTo enable:[0m Pull a model on the server first (e.g., ollama pull llama3.2)
[0;34m[INFO][0m Testing error handling for unreachable endpoint...
[0;34m[INFO][0m Request: GET http://remote-ollama:11434/v1/nonexistent
[0;34m[INFO][0m Elapsed time: 17796000000ms
[0;34m[INFO][0m HTTP Status: 404
[0;32mâœ“ PASS[0m Error handling for nonexistent endpoint works (404)

=== API Contract Validation Tests ===
[0;34m[INFO][0m Validating base URL format...
[0;32mâœ“ PASS[0m OLLAMA_API_BASE format matches contract (no /v1 suffix)
[0;32mâœ“ PASS[0m OPENAI_API_BASE format matches contract (with /v1 suffix)
[1;33mâŠ˜ SKIP[0m JSON mode test - server tests skipped or no models available
  [0;34mTo enable:[0m Remove --skip-server flag and pull a model on the server
[1;33mâŠ˜ SKIP[0m Streaming with include_usage test - server tests skipped
  [0;34mTo enable:[0m Remove --skip-server flag when running test.sh

=== Aider Integration Tests ===
[0;34m[INFO][0m Checking if Aider can be invoked...
[0;32mâœ“ PASS[0m Aider binary found (/Users/vm/.local/bin/aider)
[0;32mâœ“ PASS[0m Aider is in PATH: /Users/vm/.local/bin/aider
[0;34m[INFO][0m Testing if Aider can read environment variables...
[0;32mâœ“ PASS[0m Environment variables configured for Aider (OPENAI_API_BASE, OPENAI_API_KEY)
[0;34m[Test 1/40][0m End-to-end Aider test (non-interactive)
[0;34m[INFO][0m Running non-interactive Aider test with qwen2.5:0.5b...
[1;33mâŠ˜ SKIP[0m End-to-end Aider test timed out or model unavailable
  [0;34mTo enable:[0m Ensure qwen2.5:0.5b is available on server (see /tmp/aider_test_output.log)

=== Script Behavior Tests ===
[0;34m[INFO][0m Checking uninstall script availability...
[0;32mâœ“ PASS[0m Uninstall script found at ~/.ai-client/uninstall.sh
[0;34m[INFO][0m Testing uninstall script behavior...
[0;32mâœ“ PASS[0m Uninstall script has valid syntax (can run on clean system)
[0;32mâœ“ PASS[0m Install script marker comments found exactly once (idempotency verified)

=== Claude Code v2+ Tests ===
[0;34m[Test 2/40][0m Claude Code binary check
[0;34m[INFO][0m Checking for Claude Code binary...
[0;32mâœ“ PASS[0m Claude Code is installed: 2.1.38 (Claude Code)
[0;34m[Test 3/40][0m claude-ollama alias check
[0;34m[INFO][0m Checking for claude-ollama alias in shell profile...
[0;32mâœ“ PASS[0m claude-ollama alias found in shell profile
[0;34m[Test 4/40][0m claude-ollama alias environment variables
[0;34m[INFO][0m Validating claude-ollama alias configuration...
[0;32mâœ“ PASS[0m claude-ollama alias has correct environment variables
[0;34m[Test 5/40][0m POST /v1/messages (non-streaming, Anthropic API)
[0;34m[INFO][0m Testing Anthropic API endpoint...
[1;33mâŠ˜ SKIP[0m POST /v1/messages - no models available
  [0;34mTo enable:[0m Pull a model on the server first (e.g., ollama pull qwen2.5:0.5b)
[0;34m[Test 6/40][0m POST /v1/messages (streaming, Anthropic API)
[0;34m[INFO][0m Testing Anthropic API streaming endpoint...
[1;33mâŠ˜ SKIP[0m POST /v1/messages (streaming) - no models available
  [0;34mTo enable:[0m Pull a model on the server first (e.g., ollama pull qwen2.5:0.5b)
[0;34m[Test 7/40][0m Anthropic response schema validation
[0;34m[INFO][0m Validating Anthropic response schema...
[1;33mâŠ˜ SKIP[0m Anthropic response schema validation - no response available
  [0;34mTo enable:[0m Ensure Test 32 passes first
[0;34m[Test 8/40][0m Claude Code basic invocation (version check)
[0;34m[INFO][0m Testing Claude Code can be invoked...
[0;32mâœ“ PASS[0m Claude Code can be invoked successfully

=== Version Management v2+ Tests ===
[0;34m[Test 9/40][0m check-compatibility.sh script check
[0;34m[INFO][0m Checking for version compatibility script...
[0;32mâœ“ PASS[0m check-compatibility.sh script found
[0;34m[INFO][0m Script has valid syntax
[0;34m[Test 10/40][0m pin-versions.sh script check
[0;34m[INFO][0m Checking for version pinning script...
[0;32mâœ“ PASS[0m pin-versions.sh script found
[0;34m[INFO][0m Script has valid syntax
[0;34m[Test 11/40][0m .version-lock file format validation
[0;34m[INFO][0m Checking .version-lock file format...
[1;33mâŠ˜ SKIP[0m .version-lock file not found
  [0;34mTo enable:[0m Run ./client/scripts/pin-versions.sh to create lock file
[0;34m[Test 12/40][0m downgrade-claude.sh script check
[0;34m[INFO][0m Checking for version downgrade script...
[0;32mâœ“ PASS[0m downgrade-claude.sh script found
[0;34m[INFO][0m Script has valid syntax
[0;34m[Test 13/40][0m Compatibility matrix validation
[0;34m[INFO][0m Checking if compatibility matrix is populated...
[0;32mâœ“ PASS[0m Compatibility matrix has tested version pairs

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Test Summary                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[0;32mPassed:[0m  30
[0;31mFailed:[0m  1
[1;33mSkipped:[0m 11
Total:   42

[0;31mSome tests failed.[0m

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Next Steps                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â€¢ Check if server is running and accessible via Tailscale
  â€¢ Verify environment variables: source ~/.ai-client/env
  â€¢ For Claude Code issues: ensure Ollama 0.5.0+ on server, check alias configuration
  â€¢ For version issues: run check-compatibility.sh and pin-versions.sh
  â€¢ Open a new terminal to reload shell profile

